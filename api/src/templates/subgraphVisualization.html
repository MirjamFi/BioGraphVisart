<!doctype html>
<html>
<head>
    <title>Subgraph Visualization</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/qtip2/3.0.3/basic/jquery.qtip.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script> 
	
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/qtip2/3.0.3/basic/jquery.qtip.css">

	<script type="text/javascript" src="/cytoscape.js"></script> 
	<script type="text/javascript" src="/cytoscape-qtip.js"></script> 
	<script type="text/javascript" src="/dagre.js"></script>
    <script type="text/javascript" src="/cytoscape-dagre.js"></script>
    <script type="text/javascript" src="/cytoscape-no-overlap.js"></script>
    <script src="https://unpkg.com/file-saver@1.3.8/FileSaver.js"></script>
    <script src="/cytoscape-svg.js"></script>

	<script src="/initialize.js"></script>

	<script type="text/javascript" src="/icons.js"></script>
	<script type="text/javascript" src="/graph.js"></script>

	<link rel="stylesheet" type="text/css" href="/css/subgraphCss.css">
	   	
	
</head>


<body>
	<script type="text/javascript">
		if (window.File && window.FileReader && window.FileList && window.Blob) {
		  // Great success! All the File APIs are supported.
		} else {
		  alert('The File APIs are not fully supported in this browser.');
		}
	</script>
	<h1 align="center">BioGraphVisart</h1>

	<p id="description" >Load a <b>.graphml</b>-file and select node value to generate a subgraph, you can download as .svg/.png/.json.<br> Or load a <b>.json</b>-file of a previously generate subgraph, you can edit and download again.</p>

	<div id="configPart">
		
	</div>

	<p></p>



	<div id="downloadPart" style="visibility: hidden">
		<input name="outputFile" type="text" maxlength="512" id="outputName" value="File name"/>
		<button class= 'butn' id="downloadPNG" onclick="downloadPNG()" disabled="disabled">Download .png</button>
		<button class= 'butn' id="downloadSVG" onclick="downloadSVG()" disabled="disabled">Download .svg</button>
		<button class= 'butn' id="downloadJSON" onclick="downloadJSON()" disabled="disabled">Download .json</button>
	</div>
	<div align="left" id="legend" style="visibility: hidden">
		<table >
			<tr>
				<td>
					<span style="font-size:15px" ><b>Interactions</b></span> 
				</td>
				<td>
					<small><a href="https://www.kegg.jp/kegg/xml/docs/" target="_blank">kegg.jp</a></small>
				</td>
			</tr>
		</table>
		<table id="arrows">
		  <tr>
		    <td>Activation, Expression</td>
		    <td><img width="40" height="30" src="/images/activation_expression.svg" alt="" style=""></td>
		  </tr>
		  <tr>
		  	<td>Inhibition, Repression</td> 
		  	<td><img width="40" height="30" src="/images/inhibition_repression.svg" alt="" style=""></td>
		  </tr>
		  <tr>
		    <td>Compound</td>
		    <td><img width="40" height="30" src="/images/compound.svg" alt=""></td>
		  </tr>
		  <td>Indirect effect</td>
            <td><img width="40" height="30" src="/images/indirect_effect.svg" alt=""></td>
          </tr>
          <tr>
            <td>State change</td>
              <td><img width="40" height="30" src= "/images/state_change.svg" alt=""></td>
          </tr>
          <tr>
            <td>Missing interaction</td>
              <td><img width="40" height="30" src= "/images/missing_interaction.svg" alt=""></td>
          </tr>
          <tr>
            <td>Phosphorylation</td>
              <td><img width="40" height="30" src= "/images/phosphorylation.svg" alt=""></td>
          </tr>
          <tr>
            <td>Dephosphorylation</td>
              <td><img width="40" height="30" src= "/images/dephosphorylation.svg" alt=""></td>
          </tr>
          <tr>
            <td>Glycosylation</td>
              <td><img width="40" height="30" src= "/images/glycosylation.svg" alt=""></td>
          </tr>
          <tr>
            <td>Methylation</td>
              <td><img width="40" height="30" src= "/images/methylation.svg" alt=""></td>
          </tr>
          <tr>
            <td>Ubiquination</td>
              <td><img width="40" height="30" src= "/images/ubiquination.svg" alt=""></td>
          </tr>
          <tr>
            <td>Binding/association, dissociation</td>
              <td><img width="40" height="30" src= "/images/binding_association_dissociation.svg" alt=""></td>
          </tr>
		  <tr></tr>	
		  </tr>
		</table>
		<p></p>
		<div id="legendNodes"></div>
		<button class= 'butn' id="resetLayout" onclick="resetLayout()">Reset layout</button>
	</div>
	
	<div align="left" id="cy"></div>
		<script type="text/javascript">
			var img = "{{ cyto }}";
			if(img){
				var parser = new DOMParser;
				var dom = parser.parseFromString(
				     img,
				    'text/html');
				var decodedString = dom.body.textContent;
				readFile(decodedString);
			}
			var jsonFile = "{{ json }}"
			if(jsonFile){
				jsonFile = jsonFile.replace(/&lt;/g, "<");
				jsonFile = jsonFile.replace(/&gt;/g, ">");
				jsonFile = jsonFile.replace(/&lt;&#x3D;/g, "<=");
				jsonFile = jsonFile.replace(/&gt;&#x3D;/g, ">=");
				jsonFile = jsonFile.replace(/&quot;/g,'"');
				jsonFile = jsonFile.replace(/&#x3D;/g,'=')
				.replace(/\n/g, "\\n")
                .replace(/\r/g, "\\r")
                .replace(/\t/g, "\\t")
                .replace(/\f/g, "\\f")
                .replace(/"0"/g, 0)
                // .replace(/"false"/g, "false")
                // .replace(/"true"/g, "true");
				readJson(JSON.parse(jsonFile));
			}
		</script>
</body>

</html>